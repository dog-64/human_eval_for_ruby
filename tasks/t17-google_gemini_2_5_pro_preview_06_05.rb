This combines mapping and filtering in one pass.

Let's write the final code.
